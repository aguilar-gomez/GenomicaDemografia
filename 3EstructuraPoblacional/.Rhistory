names.arg=rep("", nrow(runs[[i]])),
cex.axis=0.8, yaxt="n")
}
mtext(paste("K =", i), side=2, line=0.5, cex=0.9)
}
dev.off()
#plot runs 1:3
png("AdmixtureK1-3_Finwhale.png",
width = 2400, height = 1200, res = 300)  # 8x4 pulgadas aprox.
par(mfrow=c(4,1),
mar=c(1.5, 3.5, 1, 1),
mgp=c(1.7, 0.4, 0),
xaxs="i")
for (i in 1:3){
colors_for_K <- cbPalette[[as.character(i)]]
if(i==3){
barplot(t(as.matrix(runs[[i]])), col=colors_for_K, border="black",
names.arg=sampling, las=2, cex.names=0.7,
cex.axis=0.8, yaxt="n")
} else {
barplot(t(as.matrix(runs[[i]])), col=colors_for_K, border="black",
names.arg=rep("", nrow(runs[[i]])),
cex.axis=0.8, yaxt="n")
}
mtext(paste("K =", i), side=2, line=0.5, cex=0.9)
}
dev.off()
#plot runs 1:3
png("AdmixtureK1-3_Finwhale.png",
width = 2000, height = 1200, res = 300)  # 8x4 pulgadas aprox.
par(mfrow=c(4,1),
mar=c(1.5, 3.5, 1, 1),
mgp=c(1.7, 0.4, 0),
xaxs="i")
for (i in 1:3){
colors_for_K <- cbPalette[[as.character(i)]]
if(i==3){
barplot(t(as.matrix(runs[[i]])), col=colors_for_K, border="black",
names.arg=sampling, las=2, cex.names=0.7,
cex.axis=0.8, yaxt="n")
} else {
barplot(t(as.matrix(runs[[i]])), col=colors_for_K, border="black",
names.arg=rep("", nrow(runs[[i]])),
cex.axis=0.8, yaxt="n")
}
mtext(paste("K =", i), side=2, line=0.5, cex=0.9)
}
dev.off()
#plot runs 1:3
png("AdmixtureK1-3_Finwhale.png",
width = 1500, height = 1200, res = 300)  # 8x4 pulgadas aprox.
par(mfrow=c(4,1),
mar=c(1.5, 3.5, 1, 1),
mgp=c(1.7, 0.4, 0),
xaxs="i")
for (i in 1:3){
colors_for_K <- cbPalette[[as.character(i)]]
if(i==3){
barplot(t(as.matrix(runs[[i]])), col=colors_for_K, border="black",
names.arg=sampling, las=2, cex.names=0.7,
cex.axis=0.8, yaxt="n")
} else {
barplot(t(as.matrix(runs[[i]])), col=colors_for_K, border="black",
names.arg=rep("", nrow(runs[[i]])),
cex.axis=0.8, yaxt="n")
}
mtext(paste("K =", i), side=2, line=0.5, cex=0.9)
}
dev.off()
#plot runs 1:3
png("AdmixtureK1-3_Finwhale.png",
width = 1000, height = 1200, res = 300)  # 8x4 pulgadas aprox.
par(mfrow=c(4,1),
mar=c(1.5, 3.5, 1, 1),
mgp=c(1.7, 0.4, 0),
xaxs="i")
for (i in 1:3){
colors_for_K <- cbPalette[[as.character(i)]]
if(i==3){
barplot(t(as.matrix(runs[[i]])), col=colors_for_K, border="black",
names.arg=sampling, las=2, cex.names=0.7,
cex.axis=0.8, yaxt="n")
} else {
barplot(t(as.matrix(runs[[i]])), col=colors_for_K, border="black",
names.arg=rep("", nrow(runs[[i]])),
cex.axis=0.8, yaxt="n")
}
mtext(paste("K =", i), side=2, line=0.5, cex=0.9)
}
dev.off()
par(mfrow=c(4,1),
mar=c(1.5, 1, 1, 1),
mgp=c(1.7, 0.4, 0),
xaxs="i")
for (i in 1:3){
colors_for_K <- cbPalette[[as.character(i)]]
if(i==3){
barplot(t(as.matrix(runs[[i]])), col=colors_for_K, border="black",
names.arg=sampling, las=2, cex.names=0.7,
cex.axis=0.8, yaxt="n")
} else {
barplot(t(as.matrix(runs[[i]])), col=colors_for_K, border="black",
names.arg=rep("", nrow(runs[[i]])),
cex.axis=0.8, yaxt="n")
}
mtext(paste("K =", i), side=2, line=0.5, cex=0.9)
}
par(mfrow=c(4,1),
mar=c(1.5, 3.7, 1, 1),
mgp=c(1.7, 0.4, 0),
xaxs="i")
for (i in 1:3){
colors_for_K <- cbPalette[[as.character(i)]]
if(i==3){
barplot(t(as.matrix(runs[[i]])), col=colors_for_K, border="black",
names.arg=sampling, las=2, cex.names=0.7,
cex.axis=0.8, yaxt="n")
} else {
barplot(t(as.matrix(runs[[i]])), col=colors_for_K, border="black",
names.arg=rep("", nrow(runs[[i]])),
cex.axis=0.8, yaxt="n")
}
mtext(paste("K =", i), side=2, line=0.5, cex=0.9)
}
par(mfrow=c(4,1),
mar=c(0, 3.7, 1, 1),
mgp=c(1.7, 0.4, 0),
xaxs="i")
for (i in 1:3){
colors_for_K <- cbPalette[[as.character(i)]]
if(i==3){
barplot(t(as.matrix(runs[[i]])), col=colors_for_K, border="black",
names.arg=sampling, las=2, cex.names=0.7,
cex.axis=0.8, yaxt="n")
} else {
barplot(t(as.matrix(runs[[i]])), col=colors_for_K, border="black",
names.arg=rep("", nrow(runs[[i]])),
cex.axis=0.8, yaxt="n")
}
mtext(paste("K =", i), side=2, line=0.5, cex=0.9)
}
par(mfrow=c(4,1),
mar=c(0, 3.7, 4, 1),
mgp=c(1.7, 0.4, 0),
xaxs="i")
for (i in 1:3){
colors_for_K <- cbPalette[[as.character(i)]]
if(i==3){
barplot(t(as.matrix(runs[[i]])), col=colors_for_K, border="black",
names.arg=sampling, las=2, cex.names=0.7,
cex.axis=0.8, yaxt="n")
} else {
barplot(t(as.matrix(runs[[i]])), col=colors_for_K, border="black",
names.arg=rep("", nrow(runs[[i]])),
cex.axis=0.8, yaxt="n")
}
mtext(paste("K =", i), side=2, line=0.5, cex=0.9)
}
par(mfrow=c(4,1),
mar=c(0, 3.7, 0.5, 0.5),
mgp=c(1.7, 0.4, 0),
xaxs="i")
for (i in 1:3){
colors_for_K <- cbPalette[[as.character(i)]]
if(i==3){
barplot(t(as.matrix(runs[[i]])), col=colors_for_K, border="black",
names.arg=sampling, las=2, cex.names=0.7,
cex.axis=0.8, yaxt="n")
} else {
barplot(t(as.matrix(runs[[i]])), col=colors_for_K, border="black",
names.arg=rep("", nrow(runs[[i]])),
cex.axis=0.8, yaxt="n")
}
mtext(paste("K =", i), side=2, line=0.5, cex=0.9)
}
par(mfrow=c(4,1),
mar=c(0, 3.7, 0.5, 0.5),
mgp=c(1, 0.4, 0),
xaxs="i")
for (i in 1:3){
colors_for_K <- cbPalette[[as.character(i)]]
if(i==3){
barplot(t(as.matrix(runs[[i]])), col=colors_for_K, border="black",
names.arg=sampling, las=2, cex.names=0.7,
cex.axis=0.8, yaxt="n")
} else {
barplot(t(as.matrix(runs[[i]])), col=colors_for_K, border="black",
names.arg=rep("", nrow(runs[[i]])),
cex.axis=0.8, yaxt="n")
}
mtext(paste("K =", i), side=2, line=0.5, cex=0.9)
}
#plot runs 1:3
png("AdmixtureK1-3_Finwhale.png",
width = 1000, height = 1200, res = 300)  # 8x4 pulgadas aprox.
par(mfrow=c(4,1),
mar=c(0, 3.7, 0.5, 0.5),
mgp=c(1, 0.4, 0),
xaxs="i")
for (i in 1:3){
colors_for_K <- cbPalette[[as.character(i)]]
if(i==3){
barplot(t(as.matrix(runs[[i]])), col=colors_for_K, border="black",
names.arg=sampling, las=2, cex.names=0.7,
cex.axis=0.8, yaxt="n")
} else {
barplot(t(as.matrix(runs[[i]])), col=colors_for_K, border="black",
names.arg=rep("", nrow(runs[[i]])),
cex.axis=0.8, yaxt="n")
}
mtext(paste("K =", i), side=2, line=0.5, cex=0.9)
}
dev.off()
for (i in 1:3){
colors_for_K <- cbPalette[[as.character(i)]]
if(i==3){
barplot(t(as.matrix(runs[[i]])), col=colors_for_K, border="black",
names.arg=sampling, las=2, cex.names=1,
cex.axis=0.8, yaxt="n")
} else {
barplot(t(as.matrix(runs[[i]])), col=colors_for_K, border="black",
names.arg=rep("", nrow(runs[[i]])),
cex.axis=0.8, yaxt="n")
}
mtext(paste("K =", i), side=2, line=0.5, cex=0.9)
}
#plot runs 1:3
png("AdmixtureK1-3_Finwhale.png",
width = 1000, height = 1200, res = 300)  # 8x4 pulgadas aprox.
par(mfrow=c(4,1),
mar=c(0, 3.7, 0.5, 0.5),
mgp=c(1, 0.4, 0),
xaxs="i")
for (i in 1:3){
colors_for_K <- cbPalette[[as.character(i)]]
if(i==3){
barplot(t(as.matrix(runs[[i]])), col=colors_for_K, border="black",
names.arg=sampling, las=2, cex.names=1,
cex.axis=0.8, yaxt="n")
} else {
barplot(t(as.matrix(runs[[i]])), col=colors_for_K, border="black",
names.arg=rep("", nrow(runs[[i]])),
cex.axis=0.8, yaxt="n")
}
mtext(paste("K =", i), side=2, line=0.5, cex=0.9)
}
dev.off()
cbPalette <- list(
`1` = c("#58BBDC"),
`2` = c("#58BBDC","#e9c856"),
`3` = c("#CA6E28", "#58BBDC","#e9c856"),
)
for (i in 1:3){
tempdf <- read.table(paste0("~/Documents/GitHub/GenomicaDemografia/data/admixture/","finwhale.", i, ".Q"))
temp <- as.data.frame(tempdf)
# Add sample names
temp$names <- sampling
# Store sorted data frame in list
runs[[i]] <- temp
}
#plot runs 1:3
png("AdmixtureK1-3_Finwhale.png",
width = 1000, height = 1200, res = 300)  # 8x4 pulgadas aprox.
par(mfrow=c(4,1),
mar=c(0, 3.7, 0.5, 0.5),
mgp=c(1, 0.4, 0),
xaxs="i")
for (i in 1:3){
colors_for_K <- cbPalette[[as.character(i)]]
if(i==3){
barplot(t(as.matrix(runs[[i]])), col=colors_for_K, border="black",
names.arg=sampling, las=2, cex.names=1,
cex.axis=0.8, yaxt="n")
} else {
barplot(t(as.matrix(runs[[i]])), col=colors_for_K, border="black",
names.arg=rep("", nrow(runs[[i]])),
cex.axis=0.8, yaxt="n")
}
mtext(paste("K =", i), side=2, line=0.5, cex=0.9)
}
dev.off()
#plot runs 1:3
png("AdmixtureK1-3_Finwhale.png",
width = 1000, height = 1200, res = 300)  # 8x4 pulgadas aprox.
par(mfrow=c(4,1),
mar=c(0, 3.7, 0.5, 0.5),
mgp=c(1, 0.4, 0),
xaxs="i")
for (i in 1:3){
colors_for_K <- cbPalette[[as.character(i)]]
if(i==3){
barplot(t(as.matrix(runs[[i]])), col=colors_for_K, border="black",
names.arg=sampling, las=2, cex.names=1,
cex.axis=0.8, yaxt="n")
} else {
barplot(t(as.matrix(runs[[i]])), col=colors_for_K, border="black",
names.arg=rep("", nrow(runs[[i]])),
cex.axis=0.8, yaxt="n")
}
mtext(paste("K =", i), side=2, line=0.5, cex=0.9)
}
dev.off()
cbPalette <- list(
`1` = c("#58BBDC"),
`2` = c("#58BBDC","#e9c856"),
`3` = c("#CA6E28", "#58BBDC","#e9c856"),
)
cbPalette <- list(
`1` = c("#58BBDC"),
`2` = c("#58BBDC","#e9c856"),
`3` = c("#CA6E28", "#58BBDC","#e9c856"))
for (i in 1:3){
tempdf <- read.table(paste0("~/Documents/GitHub/GenomicaDemografia/data/admixture/","finwhale.", i, ".Q"))
temp <- as.data.frame(tempdf)
# Add sample names
temp$names <- sampling
# Store sorted data frame in list
runs[[i]] <- temp
}
#plot runs 1:3
png("AdmixtureK1-3_Finwhale.png",
width = 1000, height = 1200, res = 300)  # 8x4 pulgadas aprox.
par(mfrow=c(4,1),
mar=c(0, 3.7, 0.5, 0.5),
mgp=c(1, 0.4, 0),
xaxs="i")
for (i in 1:3){
colors_for_K <- cbPalette[[as.character(i)]]
if(i==3){
barplot(t(as.matrix(runs[[i]])), col=colors_for_K, border="black",
names.arg=sampling, las=2, cex.names=1,
cex.axis=0.8, yaxt="n")
} else {
barplot(t(as.matrix(runs[[i]])), col=colors_for_K, border="black",
names.arg=rep("", nrow(runs[[i]])),
cex.axis=0.8, yaxt="n")
}
mtext(paste("K =", i), side=2, line=0.5, cex=0.9)
}
dev.off()
warnings()
for (i in 1:3){
colors_for_K <- cbPalette[[as.character(i)]]
if(i==3){
barplot(t(as.matrix(runs[[i]])), col=colors_for_K, border="black",
names.arg=sampling, las=2, cex.names=1,
cex.axis=0.8, yaxt="n")
} else {
barplot(t(as.matrix(runs[[i]])), col=colors_for_K, border="black",
names.arg=rep("", nrow(runs[[i]])),
cex.axis=0.8, yaxt="n")
}
mtext(paste("K =", i), side=2, line=0.5, cex=0.9)
}
dev.off()
cbPalette <- list(
`1` = c("#58BBDC"),
`2` = c("#e9c856","#58BBDC"),
`3` = c("#e9c856","#CA6E28", "#58BBDC"))
for (i in 1:3){
tempdf <- read.table(paste0("~/Documents/GitHub/GenomicaDemografia/data/admixture/","finwhale.", i, ".Q"))
temp <- as.data.frame(tempdf)
# Add sample names
temp$names <- sampling
# Store sorted data frame in list
runs[[i]] <- temp
}
par(mfrow=c(4,1),
mar=c(0, 3.7, 0.5, 0.5),
mgp=c(1, 0.4, 0),
xaxs="i")
for (i in 1:3){
colors_for_K <- cbPalette[[as.character(i)]]
if(i==3){
barplot(t(as.matrix(runs[[i]])), col=colors_for_K, border="black",
names.arg=sampling, las=2, cex.names=1,
cex.axis=0.8, yaxt="n")
} else {
barplot(t(as.matrix(runs[[i]])), col=colors_for_K, border="black",
names.arg=rep("", nrow(runs[[i]])),
cex.axis=0.8, yaxt="n")
}
mtext(paste("K =", i), side=2, line=0.5, cex=0.9)
}
#plot runs 1:3
png("AdmixtureK1-3_Finwhale.png",
width = 1000, height = 1200, res = 300)  # 8x4 pulgadas aprox.
par(mfrow=c(4,1),
mar=c(0, 3.7, 0.5, 0.5),
mgp=c(1, 0.4, 0),
xaxs="i")
for (i in 1:3){
colors_for_K <- cbPalette[[as.character(i)]]
if(i==3){
barplot(t(as.matrix(runs[[i]])), col=colors_for_K, border="black",
names.arg=sampling, las=2, cex.names=1,
cex.axis=0.8, yaxt="n")
} else {
barplot(t(as.matrix(runs[[i]])), col=colors_for_K, border="black",
names.arg=rep("", nrow(runs[[i]])),
cex.axis=0.8, yaxt="n")
}
mtext(paste("K =", i), side=2, line=0.5, cex=0.9)
}
dev.off()
#read in log error values to determine optimal K
log<-read.table("~/Documents/GitHub/GenomicaDemografia/data/admixture/log.errors.txt")[,c(3:4)]
#use double backslash to interpret the opening parentheses literally in the regular expression
log$V3<-gsub("\\(K=", "", log$V3)
log$V3<-gsub("):", "", log$V3)
#interpret K values as numerical
log$V3<-as.numeric(log$V3)
#rename columns
colnames(log)<-c("Kvalue","cross.validation.error")
#make plot showing the cross validation error across K values 1:10
#lowest CV value is the ideal K value
ggplot(data=log, aes(x=Kvalue, y=cross.validation.error, group=1)) +
geom_line(linetype = "dashed")+
geom_point()+
ylab("cross-validation error")+
xlab("K")+
scale_x_continuous(breaks = c(1:10))+
theme_classic(base_size = 18)
ggsave("CrossValidationV.png",width = 3, height=8)
ggsave("CrossValidationV.png",width = 4, height=5)
ggsave("CrossValidationV.png",width = 4, height=4)
sampling
setwd("~/Documents/GitHub/GenomicaDemografia/3EstructuraPoblacional")
library(ggplot2)
library(ggrepel)
library(gplots)
#read files
eigvectors <- read.table("../data/pca/finwhale_pca.eigenvec")
eigenval <- read.table("../data/pca/finwhale_pca.eigenval")
View(eigenval)
View(eigvectors)
vecs<-eigvectors[c(3:22)]
#Name columns
colnames(eigvectors)<-c("sample","names",paste0("PC",c(1:10)))
View(eigvectors)
#Population name is the first three letter
eigvectors$group <- substr(eigvectors$names, 1, 3)
# Eigenvalues: how much variance each component explains
eigvalue <- eigenval$V1/sum(eigenval$V1);
cat(signif(eigvalue , digits=3)*100,"\n");
# Plot
comp<-c(1,2)
title <- paste("PC",comp[1]," (",signif(eigvalue[comp[1]], digits=3)*100,"%)"," / PC",comp[2]," (",signif(eigvalue[comp[2]], digits=3)*100,"%)",sep="",collapse="")
xlabel = paste("PC",comp[1]," (",signif(eigvalue[comp[1]], digits=3)*100,"%)",sep="")
ylabel = paste("PC",comp[2]," (",signif(eigvalue[comp[2]], digits=3)*100,"%)",sep="")
x_axis = paste("PC",comp[1],sep="")
y_axis = paste("PC",comp[2],sep="")
#colores
cbPalette <- c( "#58BBDC","#e9c856")
ggplot() + geom_point(data=eigvectors, aes_string(x=x_axis, y=y_axis, color="group"),alpha = .8,size=3)+
scale_colour_manual(values=cbPalette)+ theme_bw(base_size = 16) +xlab(xlabel)+ylab(ylabel)+
theme(panel.border = element_rect(colour = "black", fill=NA, size=2), panel.grid.major = element_blank(),
panel.grid.minor = element_blank())
ggsave(filename=paste0("PCA_finwhale","PC",comp[1],"PC",comp[2],".png"),width=6,height=4)
#AÃ±adir etiquetas
ggplot(eigvectors, aes(x = .data[[x_axis]],
y = .data[[y_axis]],
color = group)) +
geom_point(alpha = 0.8, size = 3) +
geom_label_repel(aes(label = sample), size = 3, max.overlaps = Inf) +
scale_colour_manual(values = cbPalette) +
theme_bw(base_size = 16) +
xlab(xlabel) +
ylab(ylabel) +
theme(
panel.border = element_rect(colour = "black", fill = NA, size = 2),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank()
)
ggsave(filename = paste0("PCA_finwhale_labels_PC", comp[1], "_PC", comp[2], ".png"),
width = 6, height = 4, dpi = 300)
setwd("~/Documents/GitHub/GenomicaDemografia/3EstructuraPoblacional")
library(ggplot2)
#read in input file
data <- read.table("~/Documents/GitHub/GenomicaDemografia/data/admixture/finwhale.fam")
sampling<-data[,1]
#sort and read in log files
runs <- list()
cbPalette <- list(
`1` = c("#58BBDC"),
`2` = c("#e9c856","#58BBDC"),
`3` = c("#e9c856","#CA6E28", "#58BBDC"))
for (i in 1:3){
tempdf <- read.table(paste0("~/Documents/GitHub/GenomicaDemografia/data/admixture/","finwhale.", i, ".Q"))
temp <- as.data.frame(tempdf)
# Add sample names
temp$names <- sampling
# Store sorted data frame in list
runs[[i]] <- temp
}
par(mfrow=c(4,1),
mar=c(0, 3.7, 0.5, 0.5),
mgp=c(1, 0.4, 0),
xaxs="i")
for (i in 1:3){
colors_for_K <- cbPalette[[as.character(i)]]
if(i==3){
barplot(t(as.matrix(runs[[i]])), col=colors_for_K, border="black",
names.arg=sampling, las=2, cex.names=1,
cex.axis=0.8, yaxt="n")
} else {
barplot(t(as.matrix(runs[[i]])), col=colors_for_K, border="black",
names.arg=rep("", nrow(runs[[i]])),
cex.axis=0.8, yaxt="n")
}
mtext(paste("K =", i), side=2, line=0.5, cex=0.9)
}
